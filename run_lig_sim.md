# STEPS TO RUNNING A MD SIMULATION USING AN UNPARAMETERIZED MOLECULE

Resources:
* [Lemkul's ligand bound tutorial](http://www.mdtutorials.com/gmx/complex/01_pdb2gmx.html)
* Example mdp files
```
wget http://www.mdtutorials.com/gmx/complex/Files/ions.mdp
wget http://www.mdtutorials.com/gmx/lysozyme/Files/nvt.mdp
wget http://www.mdtutorials.com/gmx/lysozyme/Files/npt.mdp
wget http://www.mdtutorials.com/gmx/lysozyme/Files/md.mdp
```
0. Download (or obtain, say by docking) the wanted protein-ligand complex. If from the RCSB, use 
```
wget https://files.rcsb.org/view/${PDB_ID}.pdb
```
1. Extract the ligand from the PDB file (if obtained from RCSB), and hydrogenate the molecule.
```
bash hydrog_lig.sh ${PDB_ID} ${LIG_ID}
```
2. Calculate the charge on the molecule (**IF not zero; most of the time it's probably zero cause of valency**)
    * Webserver: [webchem ChargeCalculator](https://webchem.ncbr.muni.cz/Platform/ChargeCalculator)
    * Visualize charge distribution: [webchem ChargeCalculator2](https://acc2.ncbr.muni.cz/)
3. Submit your parameterization calculation to [Queensland University's tool](https://atb.uq.edu.au/index.py). It will return:
    * A GMX `.itp` file
    * (optionally) a forcefield revision compatible with nonstandard atom types.
4. Convert the ligand to a .gro file. Add the molecule's name (as generated by the program) to the topology file.
```
gmx editconf -f ${LIGAND_ID}.pdb -o ${LIGAND_ID}_proc.gro
(Add name to topol.top)
```
5. Define the unit cell and fill it with water.
```
gmx editconf -f ${LIGAND_ID}_proc.gro -o ${LIGAND_ID}_in_box.gro -c -d 1.0 -bt dodecahedron
gmx solvate -cp ${LIGAND_ID}_in_box.gro -cs spc216.gro -p topol.top -o ${LIGAND_ID}_solv.gro
```
6. Add ions as necessary.
```
gmx grompp -f ions.mdp -c ${LIGAND_ID}_solv.gro -p topol.top -o ions.tpr
gmx genion -s ions.tpr -o solv_ions.gro -p topol.top -pname NA -nname CL -neutral
```
Errors:
* ["No such moleculetype"](http://www.gromacs.org/Documentation/Errors?highlight=gromacs#Fatal_error.3a_No_such_moleculetype_XXX)

7. Run GROMPP to prepare for emin
```
gmx grompp -f params/em.mdp -c solv_ions.gro -p topol.top -o em.tpr
```
8. Run the energy minimization
```
gmx mdrun -v -deffnm em
```
9. Edit mdp files so they say "LIG" and "SOL" instead of "Protein" and "Non-Protein" in the groups list.

10. Run NVT equilibration
```
gmx grompp -f params/nvt.mdp -c em.gro -r em.gro -p topol.top -o nvt.tpr
gmx mdrun -deffnm nvt
```
11. Run NPT equilibration.
```
gmx grompp -f params/npt.mdp -c nvt.gro -r nvt.gro -t nvt.cpt -p topol.top -o npt.tpr
gmx mdrun -deffnm npt
```
12. Run ProdMD.
```
gmx grompp -f mdout.mdp -c npt.gro -t npt.cpt -p topol.top -o md_0_1.tpr
gmx mdrun -deffnm md_0_1	# ON CPU
```
13. Process prodmd to minimize RMSD, remove rotational and translational effects, and center the ligand in the box.
```
gmx trjconv -f md_0_1.trr -s md_0_1.tpr -o md_0_1_nojump.xtc -pbc nojump
gmx trjconv -f md_0_1_nojump.xtc -s md_0_1.tpr -o md_0_1_normalized.pdb -fit rot+trans
```

ERRORS:
* [Coordinates error](https://www.researchgate.net/post/How_to_correct_the_number_of_coordinates_in_gromacs_file_solvgro_topoltop)

USEFUL:
* [trjconv manual](http://manual.gromacs.org/documentation/2018/onlinehelp/gmx-trjconv.html)
* [ResearchGate post on normalizing trajectory to lowest RMSD, rot, trans invariance](https://www.researchgate.net/post/unwanted_rotation_in_gromacs)
* [ChimeraX viewing a trajectory as set of frames](https://www.cgl.ucsf.edu/chimerax/docs/user/commands/coordset.html)
* [GMX rotation matrix (rotmat)](http://manual.gromacs.org/archive/5.0.2/programs/gmx-rotmat.html)